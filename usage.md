# 前提知識  
マチェイヨラを調整する前に Unityのシェーダー について知っておきましょう。  
### シェーダーの選択  
マチェイヨラシェーダーに限らず、シェーダーには下記のような名前がついていることがあります。  
_・Opaque_  
_・Cutout / Transparent Cutout / Alpha Test / Alpha Clip_  
_・Fade / Alpha Fade_  
_・Transparent / Alpha_  
![image_RenderMode](https://user-images.githubusercontent.com/74223118/205426108-b6562168-4c63-4fc0-a4bf-01701de42b06.png)  
特に気にせず使ってしまっているかもしれませんが、  
負荷や描画結果に影響することもあるため、適切に使い分けましょう。  
* __Opaque__  
不透明なオブジェクトに使用します。  
透過する目的がなければこれを使用してください。  
![image_Opaque](https://user-images.githubusercontent.com/74223118/205426116-efde3531-cdc8-4689-b69d-81defe4c7d11.png)  
全体で光を遮るため、メッシュの形に影ができます。  
![image_OpaqueShadow](https://user-images.githubusercontent.com/74223118/205426149-a9f2e57f-8f7c-409e-8dd1-14a78b9ed83f.png)  
* __Cutout / Transparent Cutout / Alpha Test / Alpha Clip__  
テクスチャで一部だけ完全に透明にするときに使用します。  
半透明部分が存在しないため、複雑な形でもきれいに透過することができます。  
![image_Cutout](https://user-images.githubusercontent.com/74223118/205426217-99a57719-3db0-444b-a1e1-17bf307ed13a.png)  
不透明部分だけ影ができます。  
![image_CutoutShadow](https://user-images.githubusercontent.com/74223118/205426218-126acaa1-6c1d-4e93-88e2-be52afe7c43a.png)  
* __Fade / Alpha Fade__  
テクスチャで一部またはパラメータで全部を(半)透明にするときに使用します。  
反射光や金属部分も(半)透明になるため、ガラス等の表現には向きません。  
描画の不具合を防止するため一番手前にある面しか描画しません。  
アルファチャンネルに応じた影ができます。  
また、ブレンドモードを指定することにより、加算合成等の表現ができます。  
  
* __Transparent / Alpha__  
テクスチャで一部またはパラメータで全部を(半)透明にするときに使用します。  
「色」が透明になるだけなので反射は描画されます。  
ガラス等の(半)透明な材質を表現します。  
描画の不具合を防止するため一番手前にある面しか描画しません。  
また、金属は不透明な物質のため、メタリックを上げると透過しなくなります。  
![image_Transparent](https://user-images.githubusercontent.com/74223118/205426219-bd819492-6be6-4d3e-b7aa-aabf79c73723.png)  
透過部分は半透明の影ができます。  
![image_TransparentShadow](https://user-images.githubusercontent.com/74223118/205426221-7ce01508-44d5-40e7-93ec-75b14b58c341.png)  
### テクスチャのインポート設定  
テクスチャを選択すると Inspector からインポート設定を変更できます。  
主に使う項目について説明します。  
* Texture Type  
![image_TextureType](https://storage.googleapis.com/zenn-user-upload/a21b9672d29e-20220904.png)  
テクスチャのタイプを指定します。  
ノーマルマップの場合はここを Normal map にすると覚えておきましょう。  
  
* sRGB (Color Texture)  
![image_sRGB](https://storage.googleapis.com/zenn-user-upload/e4efd145d11e-20220904.png)  
テクスチャの色を数値としてシェーダーに入力する場合はここのチェックをはずします。  
詳しくはガンマ補正とかで検索してください。要するにガンマ色空間でなくリニア色空間で値を取得する設定です。  
  
* Wrap Mode  
![image_WrapMode](https://storage.googleapis.com/zenn-user-upload/7e6e65ec222d-20220904.png)  
テクスチャ座標が 0～1 の外の場合のテクスチャの状態を指定します。  
タイリングするときには Repeat、しないときは Clamp を選択してください。  
  
* Format  
![image_Format](https://storage.googleapis.com/zenn-user-upload/af1cb1eb55f5-20220904.png)  
圧縮フォーマットを設定します。基本的に Automatic で問題ないですが、  
シェーダー側で R チャンネルしか使用しない場合は R8 にするとメモリの節約になります。  
  
* Compression  
![image_Compression](https://storage.googleapis.com/zenn-user-upload/975d4f7206ca-20220904.png)  
圧縮クオリティを設定します。ノーマルマップは圧縮すると影がブロックノイズのように描画される事があるため、  
その場合は None にすることで解決できるかもしれません。  
  
# シェーダーの解説  
シェーダーのパラメータを解説します。  
  
---  
  
### 色  
  
* __メインテクスチャ__  
メインテクスチャを設定します。  
* __カラーパレット__  
指定した色をテクスチャに乗算します。  
※ Transparent の場合は 「A」の値がテクスチャのアルファチャンネルに乗算され、透過されます。  
* __MatCap__  
テクスチャをMatCapとして使用します。  
* __Tiling__  
連続するテクスチャを使用する場合はこの値を大きくしてください。  
* __Offset__  
テクスチャを X, Y 軸方向にずらすことができます。  
* __Sync X - Y__  
チェックすることで X, Y 軸を同時に変更することができます。  
  
__-Cutout のみ-__  
* __カットオフ閾値__  
この値よりテクスチャのアルファチャンネルが小さい部分は描画されません。  
* __ラメのカットオフ閾値__  
この値よりテクスチャのアルファチャンネルが小さい部分はラメが描画されません。  
  
__-Fade のみ-__  
* __ブレンディング__  
半透明部分のブレンドモードを指定します。  
  
|設定|機能|  
|---|---|  
|Normal|通常の半透明|  
|Additive|加算|  
|SoftAdditive|ソフトな加算|  
|Screen|スクリーン|  
|Manual|Blend係数を個別に指定できます。|  
  
---  
  
* __グラデーション__  
グラデーションテクスチャを設定します。  
自作のテクスチャを使用する場合は Wrap Mode を正しく設定することに注意してください。  
* __反転__  
グラデーションテクスチャを左右反転します。  
* __ブレンドモード__  
グラデーション部分のブレンドモードを指定します。  
* __ブレンド率__  
グラデーション部分のブレンド率を指定します。  
* __パワー__  
グラデーションのかかる強さを調整できます。  
* __シフト__  
グラデーションをずらすことができます。  
* __フレネルレベル__  
リムライトのようなフレネル表現ができます。  
* __反転__  
フレネルの反転ができます。  
* フレネルパワー  
フレネルがかかる強さを指定します。  
  
---  
  
* __エミッションブースト__  
Albedo の色を明るくすることができます。  
発光表現のために 1 を超える値を設定できるようにしています。  
* __光源の影響率__  
光源の反射ベクトルによって更に色に変化が出ます。  
  
---  
  
### マスク  
  
* __マスク__  
グラデーションやラメを適用しない部分を指定できます。  
* __グラデーションマスク__  
グラデーションをマスクするカラーチャンネルを指定します。  
* __ラメマスク__  
ラメをマスクするカラーチャンネルを指定します。  
* __ザラザラマスク__  
ザラザラをマスクするカラーチャンネルを指定します。  
* __エミッションマスク__  
エミッションブーストをマスクするカラーチャンネルを指定します。  
* __カーボンマスク__  
カーボンをマスクするカラーチャンネルを指定します。  
* __反転__  
マスク部分を反転できます。  
  
---  
  
### ディテール  
  
* __ディテールのテクスチャ__  
光沢・メタリックをテクスチャから設定できます。  
* __光沢-チャンネル__  
Standard シェーダーでいう Smoothness にあたります。  
ディテールテクスチャの指定したチャンネルから値を取得できます。  
スライダーで調整する場合は「Manual」にしてください。  
* __メタリック-チャンネル__  
Standard シェーダーでいう Metallic にあたります。  
ディテールテクスチャの指定したチャンネルから値を取得できます。  
スライダーで調整する場合は「Manual」にしてください。  
* __反転__  
ディテールテクスチャから取得した値を反転できます。  
* __調整__  
ディテールテクスチャから取得した値を調整できます。  
  
---  
  
* __ノーマルマップ__  
Normal map を指定します。  
クリアコートには反映されません。  
* __ノーマルマップ２__  
２つ目の Normal map を指定します。  
クリアコートには反映されません。  
* __DirectX__  
DirectX 用のノーマルマップを使用するときにチェックします。  
* __レベル__  
ノーマルマップの強度を設定します。  
  
---  
  
* __ザラザラのテクスチャ__  
塗装部分に微細な凹凸があるような表現ができます。  
Glitter テクスチャをアサインすることで有効化します。  
* __レベル__  
ザラザラの強さを指定できます。  
  
---  
  
### クリアコート  
  
* __クリアコート__  
クリアコートを オン / オフ できます。  
* __ノーマルマップ__  
クリアコートにノーマルマップを適用できます。  
* __カラー__  
クリアコートの色を指定します。  
クリアコートの厚さが２以上のときに色が変わります。  
* __厚さ__  
クリアコートの厚さを指定します。  
  
---  
  
### ラメ  
* __ラメの量__  
Low, Highに設定するとラメ表現ができます。  
Low ではラメの間隙が狭いとリアリティがなくなるため  
High でラメを重ねることでリアリティを出すことができます。  
* __彩度__  
ラメの彩度を設定します。  
* __色相__  
ラメの色相を調整します。  
ラメの色は見る方向からも変化します。  
* __縦横比__  
ラメの縦横比を調整できます。  
* __ボリューム__  
ラメの量を設定します。  
* __間隙__  
ラメ同士の間隙を設定します。  
* __まばら__  
ラメを間引く量を設定します。  
* __メタリック__  
ラメのメタリックを指定します。  
* __光沢__  
ラメの光沢を指定します。  
  
---  
  
### カーボンファイバー  
  
* __カーボンファイバー__  
カーボンファイバーを オン / オフ できます。  
* __カーボン色__  
チェックボックスをオンにするとカーボンの色を指定できるようになります。  
* __カーボンアングル__  
カーボンのストライプを90度回転することができます。  
* __カーボンディテール__  
カーボンのAOを調整します。  
* __レベル__  
カーボンの立体感を調整します。  
  
---  
  
### Advanced  
* __カリングモード__  
Off にすると裏面も描画することができます  
* __Render Queue__  
シーン内の描画順を整理します。  
シーン全体に影響し、他プレイヤーの迷惑になるおそれがあるため、  
この設定項目について十分に理解し、且つ変更する必要がある場合のみ変更してください。  
  
---  
  
# マテリアル設定のヒント  
参考にできそうな設定を紹介します。  
  
<details>  
<summary>CG テクスチャサイトのアセットを使いたい</summary>  
  
CG テクスチャサイトのアセットを使用することができます。  
( [おすすめサイト - ambientCG](https://ambientcg.com) )  
![](https://storage.googleapis.com/zenn-user-upload/c71671954dc1-20221003.png)  
  
**使用可能なテクスチャ**  
* Color  
* Roughness  
* Metalness  
* Normal Map  
  
**RoughnessマップとMetalnessマップを同時に使用する場合はひとつのテクスチャにまとめる必要があります。**  
    
**1. テクスチャを用意する**  
使用可能なテクスチャを用意してください。  
  
**2. Roughnessマップ・Metalnessマップをまとめる**  
Photoshop等でカラーチャンネル別にマップを格納します。  
  
![](https://storage.googleapis.com/zenn-user-upload/b9a8f7f758a4-20221003.png)  
_Roughness マップをインポートする_  
![](https://storage.googleapis.com/zenn-user-upload/3c41ad756427-20221003.png)  
_背景からレイヤーに変更する_  
![](https://storage.googleapis.com/zenn-user-upload/a14ec4fc1d8f-20221003.png)  
_RGB モードに変更する_  
![](https://storage.googleapis.com/zenn-user-upload/f4080375cbfa-20221003.png)  
_G・B チャンネルを黒に塗りつぶす_  
![](https://storage.googleapis.com/zenn-user-upload/81e3c62590db-20221003.png)  
_Metalness マップをインポートする_  
![](https://storage.googleapis.com/zenn-user-upload/1f6f616dce68-20221003.png)  
_Roughness マップの G チャンネルに Metalness マップをペーストする_  
![](https://storage.googleapis.com/zenn-user-upload/b1e9252922d7-20221003.png)  
_画像データとして保存する_  
  
**3. テクスチャを Unity にインポートする**  
![](https://storage.googleapis.com/zenn-user-upload/0331e0c6ff11-20221003.png)  
_Roughness マップ・Metalness マップは sRGB のチェックを外す_  
![](https://storage.googleapis.com/zenn-user-upload/891c217f0c60-20221003.png)  
_Normal Map は Texture Type を Normal map に設定する_  

**Unity では OpenGL 用のノーマルマップを使用します。**  
**DirectX 用のノーマルマップを使用する場合はマテリアル設定で DirectX のチェックを入れます。**  
  
**4. マテリアルを設定する**  
![](https://storage.googleapis.com/zenn-user-upload/59aadd1ad555-20221003.png)  
* Color  
`色` → `テクスチャ`  
* Roughness・Metalness  
`ディテール` → `ディテールテクスチャ`  
`光沢-チャンネル` → `R` `反転`  
`メタリック-チャンネル` → `G`  
* Normal Map  
`ディテール` → `ノーマルマップ`  
  
</details>  
  
<details>  
<summary>シンプルな Skybox でもキレイに反射させたい</summary>  
  
シンプルな Skybox でも MatCap を使うことでキレイに反射できます。  
![](https://storage.googleapis.com/zenn-user-upload/6e0ab1d2150e-20221003.png)  
**1. 反射に使いたい MatCap テクスチャを用意する。**  
**2. マテリアルを設定する**  
`色` → `テクスチャ` → `MatCap をセット` `MatCap`  
`色` → `ブレンドモード` → `Multiply`  
`色` → `ブレンド率` → `1`  
  
</details>  
  
<details>  
<summary>リアルなカーボン素材を表現したい</summary>  
  
カーボンファイバーはクリアコートに使用痕をもたせるとリアルに見えます。  
![](https://storage.googleapis.com/zenn-user-upload/70c3ea6225df-20221010.png)  
**1. ダメージ表現用のテクスチャを用意する**  
**2. マテリアルを設定する**　  
`ディテール` → `光沢-チャンネル` → `Manual`  
`ディテール` → `光沢` → `0.7`  
`ディテール` → `メタリック-チャンネル` → `Manual`  
`ディテール` → `メタリック` → `0.95`  
`クリアコート` → `On`  
`クリアコート` → `光沢-チャンネル` → `任意のチャンネル`  
`カーボンファイバー` → `On`  
`カーボンファイバー` → `カーボン色１` → `On` → `#333333`  
`カーボンファイバー` → `カーボン色２` → `On` → `#484848`  
  
**3. 必要に応じてノーマルマップもつけると良いかもしれません**  
![](https://storage.googleapis.com/zenn-user-upload/df0aff036fac-20221010.png)  
`クリアコート` → `ノーマルマップ`  
`クリアコート` → `レベル` → `0.5`  
  
</details>  